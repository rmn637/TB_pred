<!DOCTYPE html>
<html>
<head>
    <title>Neuro-TB Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='myca.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="main-container">
        <aside class="sidebar">
            <div class="icon-circle">
                <i class="fa-solid fa-lungs"></i>
            </div>
            <div class="logo">Neuro-TB</div>
            <a href="/med_form" class="add-pred-btn">Fill up Medical Form</a>
            <div class="nav">
                <button class="active" onclick="showSection('overview', this)">Overview</button>
                <button onclick="showSection('visuals', this)">Visualizations</button>
                <button onclick="showSection('models', this)">Model Performance</button>
                <button onclick="showSection('datasets', this)">Dataset Analytics</button>
            </div>
            <a href="/logout" class="logout-btn" role="button">Logout</a>
        </aside>
        <div class="content-area">
            <!-- Overview Section -->
            <div class="overview_window">
                <div id="overview" class="section active">
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-label">Total Patients</div>
                            <div class="stat-value" id="totalPatients">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">TB Cases</div>
                            <div class="stat-value" id="tbCases">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Model Accuracy</div>
                            <div class="stat-value">72%</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Visualizations Section -->
            <div class="visuals_window">
                <div id="visuals" class="section">
                    <h2>Data Visualizations</h2>
                    <div class="content-box">
                        <div class="pie-linecharts">
                            <div class="pies">
                                <div class="pchart">
                                    <h3>Positive TB vs Negative TB cases</h3>
                                    <canvas id="tbChart"></canvas>
                                    <p id="tbChartDetails" class="chart-details"></p>
                                </div>
                                <div class="pchart">
                                    <h3>Gender Distribution (TB Positive)</h3>
                                    <canvas id="genderChart"></canvas>
                                    <p id="genderChartDetails" class="chart-details"></p>
                                </div>
                            </div>
                            <div class="lchart">
                                <h3>Age vs TB Likelihood</h3>
                                <canvas id="ageVsTBChart"></canvas>
                            </div>
                        </div>

                        <div class="bargraphs">
                            <div class="bchart">
                                <h3>Age Distribution of TB Positive Patients</h3>
                                <canvas id="ageChart"></canvas>
                            </div>

                            <div class="bchart">
                                <h3>Symptoms of TB Positive Patients</h3>
                                <canvas id="symptomChart"></canvas>
                            </div>

                            <div class="bchart">
                                <h3>Body Systems Affected by TB</h3>
                                <canvas id="systemChart"></canvas>
                            </div>
                        </div>

                        <div class="hider"> <!--Hidden-->
                            <div style="width: 600px; margin: 20px auto; text-align: right;">
                                <label for="dateRangeSelect">View By:</label>
                                <select id="dateRangeSelect">
                                    <option value="day">Day</option>
                                    <option value="week">Week</option>
                                    <option value="year">Year</option>
                                </select>
                            </div>
                            <div style="width: 600px; margin: 40px auto;">
                                <h3>TB Admissions Over Time</h3>
                                <canvas id="dateTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Analytics Section -->
            <div id="models" class="section">
                <h2>Model Performance</h2>
                <div class="dashboard-images">
                    <img src="{{ url_for('static', filename='images/ConfusionMatrix.png') }}" alt="Confusion Matrix">
                    <img src="{{ url_for('static', filename='images/ROCCurve.png') }}" alt="ROC Curve">
                    <div style="margin-bottom:32px;">
                        <h3>Classification Report</h3>
                        <table style="width:100%; max-width:100%; margin:18px 0; border-collapse:collapse; font-size:1rem;">
                            <thead>
                                <tr style="background:var(--medical-light); color:var(--text-primary);">
                                    <th style="padding:8px 12px; text-align:left;">Class</th>
                                    <th style="padding:8px 12px; text-align:right;">Precision</th>
                                    <th style="padding:8px 12px; text-align:right;">Recall</th>
                                    <th style="padding:8px 12px; text-align:right;">F1-score</th>
                                    <th style="padding:8px 12px; text-align:right;">Support</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td style="padding:6px 12px;">0 (No TB)</td><td style="padding:6px 12px; text-align:right;">0.81</td><td style="padding:6px 12px; text-align:right;">0.75</td><td style="padding:6px 12px; text-align:right;">0.78</td><td style="padding:6px 12px; text-align:right;">72</td></tr>
                                <tr><td style="padding:6px 12px;">1 (Has TB)</td><td style="padding:6px 12px; text-align:right;">0.58</td><td style="padding:6px 12px; text-align:right;">0.66</td><td style="padding:6px 12px; text-align:right;">0.62</td><td style="padding:6px 12px; text-align:right;">38</td></tr>
                                <tr style="background:var(--medical-light); font-weight:600;">
                                    <td style="padding:6px 12px;">Accuracy</td>
                                    <td colspan="4" style="padding:6px 12px; text-align:right;">0.72 (110 samples)</td>
                                </tr>
                                <tr>
                                    <td style="padding:6px 12px;">Macro avg</td>
                                    <td style="padding:6px 12px; text-align:right;">0.69</td>
                                    <td style="padding:6px 12px; text-align:right;">0.70</td>
                                    <td style="padding:6px 12px; text-align:right;">0.70</td>
                                    <td style="padding:6px 12px; text-align:right;">110</td>
                                </tr>
                                <tr>
                                    <td style="padding:6px 12px;">Weighted avg</td>
                                    <td style="padding:6px 12px; text-align:right;">0.73</td>
                                    <td style="padding:6px 12px; text-align:right;">0.72</td>
                                    <td style="padding:6px 12px; text-align:right;">0.72</td>
                                    <td style="padding:6px 12px; text-align:right;">110</td>
                                </tr>
                            </tbody>
                        </table>
                        <div style="max-width: 100%;color:var(--text-secondary);font-size:1rem;text-align: justify;">
                            <strong>Interpretation:</strong> The model achieves an overall accuracy of <b>73%</b>. For patients without TB (class 0), the model is more precise and has a higher F1-score than for those with TB (class 1). The recall for class 1 (0.68) means the model correctly identifies 68% of actual TB cases, but may miss some. The macro and weighted averages summarize performance across both classes. This report helps you understand the model's strengths and where it may need improvement, especially in detecting TB-positive cases.
                        </div>
                    </div>
                </div>
            </div>
            <!-- Dataset Analytics Section -->
            <div id="datasets" class="section">
                <h2>Dataset Analytics</h2>
                <div class="dashboard-top-row">
                    <div class="dashboard-row">
                    <div class="chart-left">
                        <img src="/static/images/ClassDistribution.png" alt="Class Distribution">
                    </div>
                    <div class="chart-right">
                        <img src="/static/images/InformationGainRanking.png" alt="Information Gain Ranking">
                    </div>
                    </div>
                </div>
                <div class="dashboard-bottom-row">
                    <div class="chart-half">
                        <img src="{{ url_for('static', filename='images/CorrelationMatrix.png') }}" alt="Correlation Matrix">
                    </div>
                    <div class="feature-table-card">
                        <h3>Top Features by Information Gain</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Feature</th>
                                    <th style="text-align:right;">Mutual Information</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>age</td><td style="text-align:right;">0.156</td></tr>
                                <tr><td>coughdur</td><td style="text-align:right;">0.113</td></tr>
                                <tr><td>cough</td><td style="text-align:right;">0.072</td></tr>
                                <tr><td>colddur</td><td style="text-align:right;">0.033</td></tr>
                                <tr><td>feverdur</td><td style="text-align:right;">0.022</td></tr>
                                <tr><td>dob</td><td style="text-align:right;">0.014</td></tr>
                                <tr><td>sputum</td><td style="text-align:right;">0.014</td></tr>
                                <tr><td>backpain</td><td style="text-align:right;">0.009</td></tr>
                                <tr><td>jointpain</td><td style="text-align:right;">0.009</td></tr>
                                <tr><td>chestpain</td><td style="text-align:right;">0.008</td></tr>
                            </tbody>
                        </table>
                        <p class="feature-explanation">
                            <strong>Explanation:</strong> Information gain (mutual information) measures how much knowing a feature reduces uncertainty about the TB diagnosis. Features with higher values (like <b>age</b> and <b>cough duration</b>) are more informative for the model’s predictions. This ranking helps identify which patient data points are most important for accurate TB risk assessment.
                        </p>
                    </div>
                </div>
            </div>

            <div class="footer">
                Built with Flask, MySQL & Advanced ML Models
            </div>
        </div>
    </div>
    <button id="myca-button"><i class="fa-regular fa-comment"></i></button>

    <div id="myca-chatbox">
        <div id="chat-messages" style="display: flex; flex-direction: column;"></div>
        <div id="chat-input">
            <input type="text" id="user-message" placeholder="Ask a question about TB..." />
            <button id="send-button">Send</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='myca.js') }}"></script>
    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-box-and-violin-plot/build/Chart.BoxPlot.min.js"></script>
</body>
</html>